<script>
  new SlimSelect({
    select: '#multi'
  })
</script>
<h1>Admin Page</h1>
<p><a href="/">Go back to homepage</a></p>
<table id="table_contact">
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Phone</th>
    <th>Email</th>
    <th>Interest(s)</th>
    <th>Subscriber to the Newsletter</th>
  </tr>
  <% @contacts.each do |c| %>
    <tr>
      <td><%= c.id %></td>
      <td><%= c.name %></td>
      <td><%= c.phone %></td>
      <td><%= c.email %></td>
      <td>
        <% @contact_interests.each do |c_i| %>
          <% if c_i.contact_id == c.id && @interests.exists?(c_i.interest_id) %>
            <%= @interests.find(c_i.interest_id).name %>, 
          <% end %>
        <% end %>
      </td>
      <td>
        <% if @subs.exists?(subscriber_id: c.id) %>
          YES
        <% else %>
          NO
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
<h2>Update a user by id</h2>
<%= form_with url: "/admin", method: "patch", local: true do %>
  <p>
    <input type="number" name="id" placeholder="id (NOT changed)" required>
    <input type="text" name="name" placeholder="new name">
    <input type="tel" name="phone" placeholder="new phone">
    <input type="email" name="email" placeholder="new email">
  </p>
  <p>
    <%= select_tag "multi", options_from_collection_for_select(@interests, 'id', 'name'), :multiple => true, :required => true, :autocomplete => true %>
  </p>
  <p>
    <%= check_box_tag(:newsletter_subscriber) %>
    <%= label_tag(:newsletter_subscriber, "Receive Newsletter") %>
  </p>
  <p>
    <input type="submit" value="UPDATE">
  </p>
<% end %>

<h2>Delete a user</h2>
<%= form_with url: "/admin", method: "delete", local: true do %>
  <input type="number" name="user_id" placeholder="enter user ID" required>
  <input type="submit" value="DELETE">
<% end %>
<h2>Interests List</h2>
<table id="table_interest">
  <tr>
    <th>ID</th>
    <th>Name</th>
  </tr>
  <% @interests.each do |i| %>
    <tr>
      <td><%= i.id %></td>
      <td><%= i.name %></td>
    </tr>
  <% end %>
</table>
